<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Debug Finance Module</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test { margin: 20px 0; padding: 10px; background: #f5f5f5; }
        .success { color: green; }
        .fail { color: red; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>Finance Module Debug Tests</h1>
    
    <div class="test">
        <h3>Test 1: Check Password Protection</h3>
        <button onclick="testPassword()">Test Password Function</button>
        <div id="password-result"></div>
    </div>
    
    <div class="test">
        <h3>Test 2: Check Module Loading</h3>
        <button onclick="testModuleLoad()">Test Module Load</button>
        <div id="module-result"></div>
    </div>
    
    <div class="test">
        <h3>Test 3: Check New Tables</h3>
        <button onclick="testNewTables()">Test New Tables</button>
        <div id="tables-result"></div>
    </div>
    
    <script>
        const BASE_URL = 'http://ch-alb-2140286266.us-east-1.elb.amazonaws.com';
        
        async function testPassword() {
            const resultDiv = document.getElementById('password-result');
            try {
                const response = await fetch(BASE_URL + '/static/js/app.js');
                const text = await response.text();
                
                // Check for password protection code
                const hasPasswordCheck = text.includes("password !== 'Marina'");
                const hasFinanceAuth = text.includes('checkFinanceAuth');
                
                resultDiv.innerHTML = `
                    <p>Password check code: ${hasPasswordCheck ? '<span class="success">✓ Found</span>' : '<span class="fail">✗ Not found</span>'}</p>
                    <p>Finance auth function: ${hasFinanceAuth ? '<span class="success">✓ Found</span>' : '<span class="fail">✗ Not found</span>'}</p>
                `;
                
                // Show actual code snippet
                const startIdx = text.indexOf('if (mainCategory === \'finance\')');
                if (startIdx > -1) {
                    const snippet = text.substring(startIdx, startIdx + 500);
                    resultDiv.innerHTML += `<pre>${snippet.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</pre>`;
                }
            } catch (e) {
                resultDiv.innerHTML = `<span class="fail">Error: ${e.message}</span>`;
            }
        }
        
        async function testModuleLoad() {
            const resultDiv = document.getElementById('module-result');
            try {
                const response = await fetch(BASE_URL + '/modules/finance/finance_matching.js');
                const text = await response.text();
                
                // Check module exists
                const hasModule = text.includes('FinanceMatching');
                const hasInit = text.includes('FinanceMatching.init');
                
                resultDiv.innerHTML = `
                    <p>Module file accessible: ${response.ok ? '<span class="success">✓ Yes</span>' : '<span class="fail">✗ No</span>'}</p>
                    <p>FinanceMatching object: ${hasModule ? '<span class="success">✓ Found</span>' : '<span class="fail">✗ Not found</span>'}</p>
                    <p>Init function: ${hasInit ? '<span class="success">✓ Found</span>' : '<span class="fail">✗ Not found</span>'}</p>
                    <p>File size: ${text.length} bytes</p>
                `;
            } catch (e) {
                resultDiv.innerHTML = `<span class="fail">Error: ${e.message}</span>`;
            }
        }
        
        async function testNewTables() {
            const resultDiv = document.getElementById('tables-result');
            try {
                const response = await fetch(BASE_URL + '/modules/finance/finance_matching.js');
                const text = await response.text();
                
                // Check for new table tabs
                const hasAllIninTab = text.includes('all-inin-tab');
                const hasAllCsbTab = text.includes('all-csb-tab');
                const hasAllIninButton = text.includes('All ININ Data</button>');
                const hasAllCsbButton = text.includes('All CSB Data</button>');
                const hasAllIninTbody = text.includes('all-inin-tbody');
                const hasAllCsbTbody = text.includes('all-csb-tbody');
                
                resultDiv.innerHTML = `
                    <p>All ININ tab: ${hasAllIninTab ? '<span class="success">✓ Found</span>' : '<span class="fail">✗ Not found</span>'}</p>
                    <p>All CSB tab: ${hasAllCsbTab ? '<span class="success">✓ Found</span>' : '<span class="fail">✗ Not found</span>'}</p>
                    <p>All ININ button: ${hasAllIninButton ? '<span class="success">✓ Found</span>' : '<span class="fail">✗ Not found</span>'}</p>
                    <p>All CSB button: ${hasAllCsbButton ? '<span class="success">✓ Found</span>' : '<span class="fail">✗ Not found</span>'}</p>
                    <p>All ININ tbody: ${hasAllIninTbody ? '<span class="success">✓ Found</span>' : '<span class="fail">✗ Not found</span>'}</p>
                    <p>All CSB tbody: ${hasAllCsbTbody ? '<span class="success">✓ Found</span>' : '<span class="fail">✗ Not found</span>'}</p>
                `;
                
                // Check for display logic
                const hasDisplayLogic = text.includes('Display ALL ININ data');
                resultDiv.innerHTML += `<p>Display logic: ${hasDisplayLogic ? '<span class="success">✓ Found</span>' : '<span class="fail">✗ Not found</span>'}</p>`;
            } catch (e) {
                resultDiv.innerHTML = `<span class="fail">Error: ${e.message}</span>`;
            }
        }
    </script>
</body>
</html>